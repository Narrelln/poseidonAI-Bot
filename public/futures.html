<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Poseidon AI ‚Äî Futures Dashboard</title>

  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>
  <!-- Core styles first -->
  <link href="/styles/theme.css" rel="stylesheet"/>
  <link href="/styles/futures-core.css" rel="stylesheet"/>
  <link href="/styles/futures.css" rel="stylesheet"/>
  <link href="/styles/tables.css" rel="stylesheet"/>
  <link href="/styles/bot.css" rel="stylesheet"/>
  <link href="/styles/modal.css" rel="stylesheet"/>
  <link href="/styles/scannerPanel.css" rel="stylesheet"/>
  <link href="/styles/positionCard.css" rel="stylesheet"/>
  <link href="/styles/manual-controls.css" rel="stylesheet"/>
  <link href="/styles/signal-qa.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css?family=Orbitron:400,700|Share+Tech+Mono:400,700&display=swap" rel="stylesheet"/>

  <!-- Runtime switches -->
  <script>
    window.POSEIDON_FEED_TRACE = false;
    window.POSEIDON_SILENCE_TRACE = true;
    window.POSEIDON_AUTOTRADE_ENABLED = false;   // keep FALSE while auditing
    window.POSEIDON_PAPER = true;
    window.POSEIDON_SIGNAL_AUDIT = true;
    window.POSEIDON_MIN_NOTIONAL = 25;
  </script>

  <style>
    /* -------- Corner Dock (audit + voice + status) -------- */
    .dock{position:fixed;left:12px;bottom:12px;z-index:9998;display:flex;align-items:flex-end;gap:8px;pointer-events:none}
    .dock .dock-toggle{pointer-events:auto;width:22px;height:22px;border-radius:50%;background:#0b2433;border:1px solid #1f4358;color:#8fd3ff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:700}
    .dock .dock-stack{pointer-events:auto;display:flex;flex-direction:column;gap:6px;max-width:46vw}
    .dock .dock-pill{background:#0c0f17;border:1px solid #2b3a4a;color:#d8f0ff;border-radius:10px;padding:6px 10px;font:12px/18px var(--mono, monospace);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .dock.collapsed .dock-stack{display:none}
    #voice-toggle.on{background:#10341d;border-color:#1f8f3a}
    @media (max-width:900px){.dock{left:8px;bottom:8px}.dock .dock-stack{max-width:80vw}}
    /* Small helpers */
    #status-board{background:#0b0b1a;border:1px solid #444;padding:10px;max-height:500px;overflow-y:auto;font-family:monospace;color:#fff}
    .status-entry{border-bottom:1px solid #222;padding:6px 0}
    .status-entry strong{color:#0ff}
    .tag.buy{background:#0f04;color:#0f0}.tag.sell{background:#4004;color:#f44}.tag.pump{background:#040;color:#0f0}.tag.drop{background:#400;color:#f44}
    #modal-root{position:fixed;inset:0;z-index:9999;pointer-events:none}
    #signal-qa-stats .mini-block{min-width:120px}
    #signal-qa-feed .log-entry.text-green{color:#22c55e}
    #signal-qa-feed .log-entry.text-red{color:#ef4444}
  </style>
</head>
<body>
  <!-- Bot status pill (top-left) -->
  <div id="poseidon-bot" class="active">
    <img src="/assets/robot.png" alt="Poseidon Bot"/>
    <div class="panel" id="memory-panel">Poseidon. Strategy loaded!</div>
    <div id="poseidon-toggle"></div>
    <span id="poseidon-status" class="poseidon-bot-status text-red">Poseidon Bot: OFF</span>
  </div>

  <nav class="nav-bar">
    <a class="active" href="/futures.html">Futures</a>
    <a href="/dashboard.html">Dashboard</a>
    <a href="/sniper.html">Sniper</a>
    <a href="/trade-monitor.html">Trade Monitor</a>
    <a href="/accounts.html">Accounts</a>
    <a href="/settings.html">Settings</a>
    <a href="/index.html" style="color:#aaa;">Log Out</a>
  </nav>

  <main class="futures-grid" style="display:flex;gap:32px;align-items:flex-start;margin-top:22px;padding:0 12px;">
    <!-- LEFT COLUMN -->
    <div class="futures-col" style="flex:1 1 0;min-width:330px;padding-right:16px;border-right:2px solid #112b3a;">
      <section class="account-glance">
        <div class="mini-block wallet-block"><h4>üí∞ Wallet</h4><p>Total: <span id="wallet-total">--</span> USDT</p><p>Avail: <span id="wallet-available">--</span> USDT</p></div>
        <div class="mini-block capital-block"><h4>üíπ Capital</h4><p>Score: <span id="capital-score-display">--</span></p></div>
      </section>

      <section class="panel" id="scanning-feed">
        <div id="scanner-panel">
          <table class="scanner-table">
            <thead><tr><th>Symbol</th><th>Tag</th><th>Price</th><th>%</th><th>Quote Vol</th></tr></thead>
            <tbody id="scanner-table-body"></tbody>
          </table>
        </div>
      </section>

      <section class="panel collapsible-panel">
        <div class="panel-header"><h2>üì° Signal Analysis</h2><button class="collapse-btn">‚àí</button></div>
        <div class="panel-body">
          <div class="feed-filter-wrapper">
            <label for="signal-filter" style="font-weight:bold;margin-right:6px;">Show:</label>
            <select id="signal-filter">
              <option value="all">All</option>
              <option value="high-confidence">High Confidence (‚â• 80%)</option>
              <option value="trap-warning">Trap Warnings</option>
            </select>
          </div>
          <div id="futures-signal-feed" class="log-feed">
            <table class="signal-table">
              <thead><tr><th>Time</th><th>Symbol</th><th>Signal</th><th>Conf</th><th>Œî</th><th>Vol</th><th>Price</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <div class="feed-filter-wrapper" style="margin-bottom:10px;display:flex;align-items:center;gap:8px;">
        <label for="feed-filter" style="font-weight:bold;margin-right:6px;">Show:</label>
        <select id="feed-filter">
          <option value="all">All</option>
          <option value="hot">Hot Tokens</option>
          <option value="decision">Decisions</option>
          <option value="analysis">Analysis</option>
          <option value="memory">Memory</option>
          <option value="ppda">PPDA</option>
        </select>
        <button id="feed-mode-toggle" class="feed-toggle-btn" type="button" title="Toggle fun/serious"></button>
      </div>

      <div id="futures-log-feed" class="log-feed"></div>

      <section class="panel" id="trade-history-panel">
        <h2>üìà Trade History</h2>
        <div class="trade-history-container">
          <table class="trade-history-table">
            <thead><tr><th>Symbol</th><th>Side</th><th>Entry</th><th>Exit</th><th>Qnt</th><th>PNL</th><th>ROI</th><th>Status</th><th>Date</th></tr></thead>
            <tbody id="trade-history-body"></tbody>
          </table>
        </div>
      </section>

      <section class="panel">
        <h2>üß† Deep Learning Memory</h2>
        <div id="learning-memory-panel"><div class="log-entry">Loading learning stats...</div></div>
      </section>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="futures-col" style="flex:1 1 0;min-width:330px;">
      <section class="panel" style="padding:12px 16px;">
        <h2 style="margin-top:0;">üìä Account Overview</h2>
        <div class="compact-grid">
          <div class="mini-block"><h4>üìà Strategy</h4><p>Trades: <span id="fut-total">--</span></p><p>Win: <span id="fut-winrate">--</span></p><p>Avg ROI: <span id="fut-roi">--</span></p><p>Top: <span id="fut-topcoin">--</span></p></div>
          <div class="mini-block"><h4>ü§ñ Auto Status</h4><p>Status: <span id="futures-connection" class="text-green">--</span><span id="futures-connection-dot" style="margin-left:10px;">üî¥</span></p><p>Last: <span id="futures-last-trade">--</span></p><p>Live PnL: <span id="futures-live-pnl">--</span></p></div>
          <div class="mini-block"><h4>üìÖ Session + Strategy</h4><p>Wallets: <span id="wallets-tracked">0</span></p><p>Tokens: <span id="tokens-monitored">0</span></p><p>Active: <span id="active-trades">0</span></p><p>PNL: <span id="session-pnl">+0.00%</span></p><hr style="border-color:#333;margin:4px 0;"/><p>Wins: <span id="session-wins">0</span></p><p>Losses: <span id="session-losses">0</span></p><p>Win Rate: <span id="session-winrate">0%</span></p><p>Top Trade: <span id="top-trade">--</span></p><p>Win Streak: <span id="win-streak">0</span></p><p>Loss Streak: <span id="loss-streak">0</span></p></div>
        </div>
      </section>

      <section class="panel manual-panel glowing-panel">
        <h2>‚öôÔ∏è Manual Trade Controls</h2>
        <div id="manual-preview-tooltip" class="manual-preview-tooltip">Live preview...</div>
        <form id="manual-trade-form" autocomplete="off">
          <div class="row">
            <input type="text" id="manual-symbol" class="manual-input" placeholder="SYMBOL e.g (DOGE)" list="symbol-options"/>
            <datalist id="symbol-options"></datalist>
          </div>
      
          <div class="row sliders triple-bubble-row">
            <div class="bubble-box"><label>Size</label><div class="bubble" id="manual-size-value">0.1</div></div>
            <div class="bubble-box"><label>Price</label><div class="bubble warning" id="manual-price-preview">--</div></div>
            <div class="bubble-box"><label>üí∞ Value</label><div class="bubble success" id="manual-value-preview">--</div></div>
          </div>
      
          <!-- ‚¨áÔ∏è only this line changed (max=5000) -->
          <input type="range" id="manual-size" min="0.1" max="5000" step="0.1" value="0.1"/>
      
          <div class="row sliders">
            <label>Leverage <span id="manual-leverage-value" class="bubble">5x</span></label>
            <input type="range" id="manual-leverage" min="1" max="20" step="1" value="5"/>
          </div>
          <div class="row sliders"><label>TP <span id="manual-tp-value" class="bubble">35%</span></label><input type="range" id="manual-tp" min="10" max="100" value="35"/></div>
          <div class="row sliders"><label>SL <span id="manual-sl-value" class="bubble">20%</span></label><input type="range" id="manual-sl" min="5" max="50" value="20"/></div>
      
          <div class="row direction-row">
            <button type="button" id="manual-long" class="dir-btn long selected">Long</button>
            <button type="button" id="manual-short" class="dir-btn short">Short</button>
          </div>
      
          <div class="row actions"><button type="button" id="open-trade" class="trade-btn open">üü¢ Open Trade</button></div>
          <div id="manual-preview" class="preview-row"></div>
        </form>
      </section>
      <section class="panel"><h2>üìÇ Open Positions</h2><div id="open-positions-root"></div></section>

      <section class="panel tp-panel" id="tp-sl-tracker-panel">
        <div class="panel-header">üß® TP / SL Tracker</div>
        <div class="panel-body"><div id="tp-feed" class="tp-feed"></div></div>
      </section>

      <section class="panel" id="ppda-monitor-panel"><h2>üìå PPDA Monitor</h2><div id="ppda-monitor-feed" class="log-feed"><div class="log-entry">Awaiting dual-entry events...</div></div></section>
      <section class="panel" id="ppda-session-summary-panel"><h2>üìä PPDA Session Summary</h2><div id="ppda-session-summary-body"><div class="log-entry">Tracking dual-resolution performance...</div></div></section>

      <section class="panel" id="poseidon-status-board"><h2>üìä Poseidon Status Board</h2><div id="status-board"><div id="status-entries"></div></div></section>

      <!-- ‚úÖ Signal QA Panel -->
      <section class="panel" id="signal-qa-panel">
        <div class="panel-header" style="display:flex;align-items:center;justify-content:space-between;">
          <h2 style="margin:0;">‚úÖ Signal QA <span id="qa-mode-badge" class="qa-badge">TEST</span></h2>
          <button id="qa-mode-toggle" class="qa-toggle" type="button">Switch to REAL</button>
        </div>
        <div id="signal-qa-stats" class="compact-grid"></div>
        <div id="signal-qa-feed" class="log-feed"></div>
      </section>
    </div>
  </main>

  <!-- Corner Dock (no overlap, single source of truth) -->
  <div id="corner-dock" class="dock collapsed" aria-label="Poseidon corner dock">
    <button id="dock-toggle" class="dock-toggle" title="Expand/Collapse">‚ñ∏</button>
    <div class="dock-stack">
      <div id="poseidon-strip" class="dock-pill">
        <strong>Poseidon</strong> ‚Ä¢ <span id="rev-status">Reversal</span>
        ‚Ä¢ tick:<span id="rev-tick">1s</span> ‚Ä¢ trades:<span id="rev-trades">0</span>
        &nbsp; | &nbsp;<strong>Cycle</strong> ‚Ä¢ tick:<span id="cyc-tick">1s</span> ‚Ä¢ trades:<span id="cyc-trades">0</span>
      </div>
      <button id="voice-toggle" class="dock-pill" type="button">Voice: OFF</button>
      <button id="open-audit-dashboard" class="dock-pill" type="button">üìà Audit Dashboard</button>
    </div>
  </div>

  <!-- Core libs (defer so they don't block layout) -->
  <script src="/socket.io/socket.io.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" defer></script>

<!-- Producers first (feed + API client) -->
<script type="module" src="/scripts/liveFeedRenderer.js"></script>
<script type="module" src="/scripts/futuresApiClient.js"></script>

<!-- üîß Boot glue (fixes datalist, session, memory, voice) -->
<script type="module" src="/scripts/pageOrchestrator.js"></script>
  <script type="module" src="/scripts/futuresPageInit.js"></script>

  <!-- Engine & bot (safe to load before scanner UI) -->
  <script type="module" src="/scripts/poseidonBotModule.js"></script>
  <script type="module" src="/scripts/futuresSignalModule.js"></script>

  <!-- Scanner (data) then its UI -->
  <script type="module" src="/scripts/poseidonScanner.js"></script>
  <script type="module" src="/scripts/scannerPanel.js"></script>

  <!-- Consumers (depend on scanner/api) -->
  <script type="module" src="/scripts/sessionStatsModule.js"></script>
  <script type="module" src="/scripts/manualTradeControls.js"></script>
  <script type="module" src="/scripts/positionEnhancer.js"></script>
  <script type="module" src="/scripts/futuresDecisionEngine.js"></script>
  <script type="module" src="/scripts/walletModule.js"></script>
  <script type="module" src="/scripts/symbolDebugger.js"></script>
  <script type="module" src="/scripts/learningMemory.js"></script>
  <script type="module" src="/scripts/capitalScoreModule.js"></script>
 
  <script type="module" src="/scripts/voiceAnnouncer.js"></script>
  <script>window.POSEIDON_TTS_VOICE = 'Microsoft Aria Online (Natural)';</script>
  <script type="module" src="/scripts/forceTradeHelper.js"></script>
  <script type="module" src="/scripts/poseidonProbe.js"></script>

  <!-- Signal QA (must follow futuresSignalModule) -->
  <script type="module" src="/scripts/signalAuditor.js"></script>
  <script type="module" src="/scripts/signalQaToggle.js"></script>
  <script type="module" src="/scripts/auditDashboard.js"></script>
  <!-- <script src="/scripts/railsInspector.js"></script> -->

  <!-- Legacy non-module -->
  <script src="/scripts/tradeHistoryPanel.js" defer></script>

  <!-- Explicit engine start (no-op if disabled) -->
  <script type="module">
    import { startSignalEngine } from '/scripts/futuresSignalModule.js';
    if (!window.POSEIDON_SIGNAL_ENGINE_DISABLED) {
      startSignalEngine();
      console.log('üöÄ Signal Engine Started');
    } else {
      console.log('üõë Signal Engine blocked by POSEIDON_SIGNAL_ENGINE_DISABLED');
    }
  </script>

<!-- Boot the Manual Trade Controls explicitly -->
<script type="module">
  import { initManualTradeControls } from '/scripts/manualTradeControls.js';

  // start only when the form exists
  function bootIfPresent() {
    const form = document.getElementById('manual-trade-form');
    if (form) {
      initManualTradeControls();
      console.log('[manual] controls initialized');
    } else {
      // try a few times in case Vite/React hot swap delayed DOM
      setTimeout(bootIfPresent, 150);
    }
  }

  if (document.readyState === 'loading') {
    window.addEventListener('DOMContentLoaded', bootIfPresent);
  } else {
    bootIfPresent();
  }
</script>


  <!-- Auto status + wallet + TP feed -->
  <script type="module">
    import { renderAutoStatus } from '/scripts/autoStatusModule.js';
    renderAutoStatus(); setInterval(renderAutoStatus, 15000);
  </script>
  <script type="module">
    import { refreshWalletBalance } from '/scripts/walletModule.js';
    refreshWalletBalance();
  </script>
  <script type="module">
    import { startTpFeedRenderer } from '/scripts/tpStatusClient.js';
    window.addEventListener('DOMContentLoaded', () => startTpFeedRenderer());
  </script>

  <!-- Dock controller -->
  <script>
    (function cornerDock(){
      const dock = document.getElementById('corner-dock');
      const btn  = document.getElementById('dock-toggle');
      if (!dock || !btn) return;
      function sync(){ const c=dock.classList.contains('collapsed'); btn.textContent=c?'‚ñ∏':'‚ñæ'; btn.setAttribute('aria-expanded', String(!c)); }
      btn.addEventListener('click', ()=>{ dock.classList.toggle('collapsed'); sync(); });
      sync();
    })();
  </script>

  <!-- Vite/React dev (load last; remove in prod) -->
  <script type="module" src="http://localhost:5173/@vite/client"></script>
  <script type="module">
    import RefreshRuntime from "http://localhost:5173/@react-refresh";
    RefreshRuntime.injectIntoGlobalHook(window);
    window.$RefreshReg$ = () => {};
    window.$RefreshSig$ = () => (type) => type;
    window.__vite_plugin_react_preamble_installed__ = true;
  </script>
  <script type="module" src="http://localhost:5173/src/main.jsx"></script>

  <!-- <script>
    window.POSEIDON_TTS_VOICE = "Microsoft Aria Online (Natural)";
  </script> -->


  <!-- Overlay root for React portals -->
  <div id="modal-root"></div>
</body>
</html>